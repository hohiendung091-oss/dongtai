1:  // === 初始化阶段 ===
2:  参数初始化(父节点选举相关阈值, 区块集共识相关阈值, 委员会规模, 传感器通信距离R等); // 初始化系统运行所需关键参数
3:  时间戳_t = 0;                                                        // 系统时间或轮次
4:  当前父网关列表_PGL = [];                                               // 当前有效的父网关节点
5:  传感器关联字典_SA = {};                                                // 存储每个传感器当前关联的父网关 {传感器ID: 父网关ID}

6:  WHILE (TRUE) DO                                                    // 系统主循环
7:      时间戳_t++;

8:      // --- 核心步骤1: (周期性)抗干扰父节点网关选举 ---
9:      IF 到达父节点选举周期(时间戳_t) THEN
10:         临时父网关列表 = [];
11:         FOR EACH 网关 G IN 全网所有网关
12:            G.综合性能指标_Q = 计算网关综合性能(G.噪声, G.计算存储, G.带宽, G.投票成功率, G.时延); // 
13:            IF G.综合性能指标_Q >= 父节点选举的性能阈值 THEN
14:                将 G 加入到 临时父网关列表;
15:            END IF
16:         END FOR
17:         当前父网关列表_PGL = 临时父网关列表;
18:         // 父节点列表更新后，触发传感器重新关联
19:         FOR EACH 传感器节点_S IN 全网传感器节点列表
20:             最短距离 = 无穷大;
21:             最佳父网关 = NULL;
22:             FOR EACH 父网关_PG IN 当前父网关列表_PGL
23:                 距离_d = 计算欧氏距离(传感器_S, 父网关_PG);
24:                 IF 距离_d <= 传感器通信距离R AND 距离_d < 最短距离 THEN // 必须在通信范围内 
25:                     最短距离 = 距离_d;
26:                     最佳父网关 = 父网关_PG;
27:                 END IF
28:             END FOR
29:             传感器关联字典_SA[传感器_S.ID] = 最佳父网关.ID; // 更新传感器的关联父网关
30:         END FOR
31:     END IF

32:     // --- 核心步骤2: (周期性)父节点网关收集数据与区块集构建 ---
33:     IF 到达数据收集与区块集构建周期(时间戳_t) THEN
34:         FOR EACH 父网关_PG IN 当前父网关列表_PGL                           // 只有父节点网关收集信息
35:             其关联的传感器列表 = 获取关联到此父网关_PG的传感器(传感器关联字典_SA, 父网关_PG.ID);
36:             IF IsEmpty(其关联的传感器列表) THEN CONTINUE; // 若无传感器关联此父网关，则跳过

37:             原始数据列表 = 父网关_PG.从其关联的传感器收集并预处理数据(其关联的传感器列表); 
38:             IF IsEmpty(原始数据列表) THEN CONTINUE;

39:             (冲突区块集_CB, 非冲突区块集_NCB) = 父网关_PG.将数据打包构建为冲突与非冲突区块集(原始数据列表);
40:             IF 冲突区块集_CB IS NOT NULL THEN
41:                 处理后冲突区块集_PCB = 父网关_PG.处理冲突区块集内部异常(冲突区块集_CB);
42:                 调用区块集共识流程(处理后冲突区块集_PCB, 当前父网关列表_PGL); // 进入步骤3
43:             END IF
44:             IF 非冲突区块集_NCB IS NOT NULL THEN
45:                 调用区块集共识流程(非冲突区块集_NCB, 当前父网关列表_PGL);   // 进入步骤3
46:             END IF
47:         END FOR
48:     END IF

49:     // --- 核心步骤3: (事件驱动)区块集共识流程 --- (由步骤2调用)
50:     FUNCTION 调用区块集共识流程(待共识区块集_B, 父网关列表_PGL)             
51:         IF IsEmpty(父网关列表_PGL) THEN RETURN;

52:         父节点委员会_PGC = 从父网关列表_PGL中随机选择k个成员();
53:         IF IsEmpty(父节点委员会_PGC) THEN RETURN;

54:         委员会投票详情列表 = [];
55:         FOR EACH 委员会成员_M IN 父节点委员会_PGC
56:             单票结果 = 成员_M.对区块集进行投票评估(待共识区块集_B, 成员_M.综合性能指标_Q);
57:             将 单票结果 加入到 委员会投票详情列表;
58:         END FOR

59:         待共识区块集_B.最终置信度 = 计算区块集最终置信度(待共识区块集_B.类型, 委员会投票详情列表);

60:         IF 待共识区块集_B.最终置信度 >= 获取对应类型的共识阈值(待共识区块集_B.类型) THEN
61:             待共识区块集_B.设为已验证状态();
62:             父区块引用列表 = 选择合适的父区块加入DAG(待共识区块集_B);
63:             待共识区块集_B.设置父区块引用(父区块引用列表);
64:             将待共识区块集_B添加到本地DAG并更新父区块引用计数();
65:             向全网广播已共识的区块集_B();
66:         ELSE
67:             IF 待共识区块集_B.尝试次数 < 最大尝试次数 THEN
68:                 重新将区块集_B加入共识队列稍后重试();
69:             ELSE
70:                 丢弃区块集_B();
71:             END IF
72:         END IF
73:     END FUNCTION

74:     // --- 核心步骤4: (周期性/并行)传感器节点本地轻量化区块管理 ---
75:     FOR EACH 传感器节点_S IN 全网传感器节点列表
76:         IF 到达传感器本地清理周期(传感器节点_S, 时间戳_t) THEN         
77:             FOR EACH 本地区块_lb IN 传感器节点_S.本地DAG副本
78:                 IF 区块_lb满足可终结条件(存在时长, 被引用次数, 是否已验证) THEN 
79:                     传感器节点_S.从本地移除区块_lb();
80:                 END IF
81:             END FOR
82:         END IF
83:     END FOR

84: END WHILE